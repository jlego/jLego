/**
 * lego.min.js v1.3.9
 * (c) 2017 Ronghui Yu
 * @license MIT
 */
"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function __async(t){return new Promise(function(e,r){function n(i,s){try{var a=t[s?"throw":"next"](i)}catch(t){return void r(t)}a.done?e(a.value):Promise.resolve(a.value).then(n,o)}function o(t){n(t,1)}n()})}var director=require("director"),object_observe=require("object.observe"),hyperx=_interopDefault(require("hyperx")),vdom=_interopDefault(require("virtual-dom")),Core=function(t){return void 0===t&&(t={}),this.config={alias:"Lego",version:"1.0.0",isDebug:!0,isAnimate:!1,isPermit:!1,isMultiWindow:!1,pageEl:"",defaultApp:"",rootUri:"",routerConfig:{},screenWidth:window.innerWidth},Object.assign(this.config,t),this._debugger(),this.prevApp="",this.currentApp="",this.Router=director.Router,this.idCounter=0,this.views={},this.datas={},this.permis={},this.timer={},this.UI={},this.routers=new Map,this};Core.prototype.isJson=function(t){var e="object"==typeof t&&"[object object]"==Object.prototype.toString.call(t).toLowerCase()&&!t.length;return e},Core.prototype.extend=function(){function t(e,r){void 0===e&&(e={}),void 0===r&&(r={});for(var o in r)r.hasOwnProperty(o)&&(n.isJson(r[o])?Array.isArray(r[o])?e[o]=Array.from(r[o]):e[o]=t(e[o],r[o]):e[o]=r[o]);return e}for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];var n=this;if(e.length>0){var o=e[0];if("object"==typeof o&&!Array.isArray(o))for(var i=1;i<e.length;i++)"object"!=typeof e[i]||Array.isArray(e[i])||(o=t(o,e[i]));return o}return{}},Core.prototype.create=function(t,e){if(void 0===e&&(e={}),e.vid=this.uniqueId("v"),e.onBefore=e.onBefore&&e.onBefore.bind(this),e.onAfter=e.onAfter&&e.onAfter.bind(this),t){if(e.permis){var r=e.permis.module,n=e.permis.operate,o=e.permis.hide,i=e.permis.userid||0;if(o&&!this.permis.check(r,n,i))return}"function"==typeof e.onBefore&&e.onBefore();var s=new t(e);return this.views[this.currentApp].set(s.el,s),"function"==typeof e.onAfter&&e.onAfter(s),s}},Core.prototype.init=function(t){return void 0===t&&(t={}),this.isEmptyObject(t)||Object.assign(this.config,t),window[this.config.alias]=window.Lego=this,this.startApp(),this},Core.prototype.components=function(t,e,r){void 0===e&&(e={}),void 0===r&&(r=!1),"string"==typeof t&&(this.UI[t]=e),"object"==typeof t&&(this.isEmptyObject(t)?this.UI=t:Object.assign(this.UI,t))},Core.prototype.param=function(t){void 0===t&&(t={});var e=[];for(var r in t)"object"==typeof t[r]&&(t[r]=JSON.stringify(t[r])),e.push(r+"="+t[r]);return e.join("&")},Core.prototype.randomKey=function(t){t=t||32;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=e.length,n="",o=0;o<t;o++)n+=e.charAt(Math.floor(Math.random()*r));return n},Core.prototype.uniqueId=function(t){var e=++this.idCounter+"";return t?t+e:e},Core.prototype.isEmptyObject=function(t){void 0===t&&(t={});for(var e in t)return!1;return!0},Core.prototype._debugger=function(){if(window.debug={},!window.console)return function(){};if(this.config.isDebug)for(var t in console)"function"==typeof console[t]&&(debug[t]=console[t].bind(window.console));else for(var e in console)"function"==typeof console[e]&&(debug[e]=function(){})},Core.prototype._initObj=function(t){this.views[t]=this.views[t]||new WeakMap,this.timer[t]=this.timer[t]||new Map},Core.prototype._clearObj=function(t){var e=this;this.prevApp!==this.currentApp&&this.timer[t].forEach(function(r,n){clearTimeout(r),clearInterval(r),e.timer[t].delete(n)})},Core.prototype.loadScript=function(t,e,r){var n=document.createElement("script");n.setAttribute("id",r),n.type="text/javascript",n.readyState?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(n.onreadystatechange=null,e())}:n.onload=function(){e()},n.src=t,document.getElementById(r)&&document.getElementsByTagName("head")[0].removeChild(document.getElementById(r)),document.getElementsByTagName("head")[0].appendChild(n)},Core.prototype.startApp=function(t,e){void 0===e&&(e={});var r,n={onBefore:function(){},onAfter:function(){}},o=this;Object.assign(n,e);var i=window.location.hash.replace(/#/,""),s=0==i.indexOf("/")?i.replace(/\//,""):"";s="index"!==s?s:"",t=t||s||this.config.defaultApp,r=this.currentApp?t.indexOf("/")>0?t.split("/")[0]:t:"index",this.prevApp=this.currentApp,this.currentApp=this.currentApp?r:"index",this._initObj(r),"function"==typeof n.onBefore&&n.onBefore(),this.loadScript(this.config.rootUri+r+"/app.js?"+this.config.version,function(){t&&"index"!==r&&(o.routers.get(r).setRoute(t),document.getElementById(o.prevApp)&&document.getElementsByTagName("head")[0].removeChild(document.getElementById(o.prevApp)),o._clearObj(o.prevApp)),"function"==typeof n.onAfter&&n.onAfter()},r)},Core.prototype.getUrlParam=function(t){if(window.pageParams={},window.pageParams[t])return window.pageParams[t];var e=decodeURI(document.location.search);if(e.indexOf("?")>=0){for(var r=e.substr(1).split("&"),n=[],o=0;o<r.length;o++)n=r[o].split("="),window.pageParams[n[0]]=n[1];return window.pageParams[t]||""}return""},Core.prototype.trigger=function(t,e){this.Eventer.emit(t,e)},Core.prototype.getAppName=function(){var t=window.location.hash.replace(/#/,"");return t=0==t.indexOf("/")?t.replace(/\//,""):"",t.split("/")[0]||this.config.defaultApp},Core.prototype.getView=function(t,e){void 0===e&&(e=this.getAppName());var r=t instanceof window.$?t[0]:document.querySelector(t);return this.views[e].has(r)?this.views[e].get(r):null},Core.prototype.setTimer=function(t,e){if(t&&e){var r=this.timer[this.getAppName()],n=r.get(t);n&&(clearTimeout(n),clearInterval(n),r.clear()),r.set(t,e)}},Core.prototype.router=function(t){var e=this.currentApp;if("index"!=e){if(!this.routers.has(e)){var r=this.Router(t).init();this.routers.set(e,r)}return this.routers.get(e)}},window.Lego=new Core;var LegoCore$1=window.Lego;window.hx=hyperx(vdom.h),window.delegateEventSplitter=/^(\S+)\s*(.*)$/;var View=function(t){void 0===t&&(t={}),this.eventNameSpace=new Map,this.options={events:null,listen:null,context:t.context||document,components:[]},Object.assign(this.options,t),this.isLoaded=!1,this.server=null,this._renderRootNode(),this.setElement(this.options.el),this.options.data="function"==typeof this.options.data?this.options.data():this.options.data||{},this._observe(),this.fetch(),this.setEvent()};View.prototype.fetch=function(t){var e=this;void 0===t&&(t={});var r=this;if(this.options.dataSource){var n=this.options.dataSource;if(n.url&&window.$)$.ajax(Lego.extend(n,{success:function(t){200==t.resultCode&&t.data&&("function"==typeof n.filter?r.options.data=n.filter(t.data):r.options.data=t.data,r.refresh())},error:function(t){debug.warn("login error: ",t)}}));else if(n.api=Array.isArray(n.api)?n.api:[n.api],n.api.forEach(function(e){n[e]=Lego.extend({},n.server.options[e],n[e]||{},t)}),n.server){var o=null;o="function"==typeof n.server?new n.server:n.server,o.fetch(n.api,{view:this},function(t){e.options.data=t,e.refresh()})}}else this._renderComponents()},View.prototype._renderRootNode=function(){var t=this;this.renderBefore();var e=this.render();if(e?(this.oldNode=e,this.rootNode=vdom.create(e),this.el=this.rootNode):this.el=document.createElement("<div></div>"),this.options.id||this.options.el)if(this.options.id)this.el.setAttribute("id",this.options.id);else if(new RegExp(/#/).test(this.options.el)){var r=this.options.el.replace(/#/,"");this.el.setAttribute("id",r),this.options.id=r}if(this.el.setAttribute("view-id",this.options.vid),this.options.style)for(var n in this.options.style)"number"==typeof t.options.style[n]&&(t.options.style[n]+="px"),t.el.style[n]=t.options.style[n];if(this.options.attr)for(var o in this.options.attr)t.el.setAttribute(o,t.options.attr[o]);this.options.className&&(this.el.className+=this.options.className),this.$el=window.$?window.$(this.el):{},this.renderAfter()},View.prototype._renderComponents=function(){var t=this,e=this.options.components;e="function"==typeof e?e(this.options):Array.isArray(e)?e:[e],e.length&&e.forEach(function(e,r){if(t.find(e.el).length){var n=e.el?t.find(e.el)[0].tagName.toLowerCase():"";n&&(e.context=t,Lego.create(Lego.UI[n],e))}})},View.prototype._observe=function(){var t=this,e=this;this.options&&"object"==typeof this.options&&Object.observe(this.options,function(r){e.renderBefore();var n=t.render(),o=vdom.diff(e.oldNode,n);e.rootNode=vdom.patch(e.rootNode,o),e.oldNode=n,e._renderComponents(),e.renderAfter()})},View.prototype.setEvent=function(){return this.unBindEvents(),this.delegateEvents(),this},View.prototype.setElement=function(t){if(t){var e=this.options.context.el||document,r="string"==typeof t?e.querySelector(t):t;if("body"==t||"append"==this.options.insert||"html"==this.options.insert){if("append"!==this.options.insert||"html"==this.options.insert)for(var n=r.childNodes,o=n.length-1;o>=0;o--)r.removeChild(n.item(o));r.appendChild(this.el)}else r.parentNode.replaceChild(this.el,r)}},View.prototype.delegateEvents=function(t){var e=this,r=this.options.events;if(!r)return this;for(var n in r){var o=r[n];if("function"!=typeof o&&(o=e[o]),o){var i=n.match(delegateEventSplitter);e.bindEvents(i[1],i[2],o.bind(e),t)}}return this},View.prototype.handler=function(t){var e=this,r=t.target,n=t.type,o=t.path,i=o.indexOf(r);if(this.eventNameSpace.has(n)){var s=this.eventNameSpace.get(n),a=[];s.forEach(function(t,r){for(var n=r?e.el.querySelectorAll(r):[e.el],s=0;s<n.length;s++){var c=o.indexOf(n[s]);c>=i&&a.push({order:c,listener:t,target:n[s]})}}),a.length&&(a.sort(function(t,e){return t.order-e.order}),a.forEach(function(e,r){var n=a[r].listener;"function"==typeof n&&n(t,a[r].target)}))}},View.prototype.bindEvents=function(t,e,r,n){if(void 0===n&&(n=!1),t&&r){if(n)this.eventNameSpace.has(t)&&this.eventNameSpace.get(t).delete(e);else if(this.eventNameSpace.has(t))this.eventNameSpace.get(t).set(e,r);else{var o=new Map;o.set(e,r),this.eventNameSpace.set(t,o),this.el.removeEventListener(t,this.handler.bind(this)),this.el.addEventListener(t,this.handler.bind(this),!1)}return this}},View.prototype.unBindEvents=function(){return this.delegateEvents(!0),this},View.prototype.find=function(t){return this.el.querySelectorAll(t)},View.prototype.$=function(t){return window.$?this.$el.find(t):null},View.prototype.render=function(){return""},View.prototype.renderBefore=function(){return this},View.prototype.renderAfter=function(){return this},View.prototype.refresh=function(){this.options.__v=Lego.randomKey()},View.prototype.remove=function(){this.unBindEvents()};var Data=function(t){var e=this;void 0===t&&(t={}),this.datas=new Map;for(var r in t)e.datas.set(r,{});this.options=t};Data.prototype.fetch=function(t,e,r){var n=this,o=Array.isArray(t)?t:[t];this.__fetch(t,e).then(function(t){o.forEach(function(e,r){n.datas.set(e,t[r])}),"function"==typeof r&&r(n.parse(t,o.join("_"),e.view))})},Data.prototype.__fetch=function(t,e){return __async(regeneratorRuntime.mark(function r(){var n,o,i,s,a,c,p,u,f;return regeneratorRuntime.wrap(function(r){for(var h=this;;)switch(r.prev=r.next){case 0:n=h,o=[],i=Array.isArray(t)?t:[t],s=Lego.isEmptyObject(e)?null:e.view,r.prev=1,a=i.map(function(t){return __async(regeneratorRuntime.mark(function r(){var o,i,a,c,p,u,f;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=n.datas.get(t)||{},i=Lego.extend({reset:!0},n.options[t]||{},s?s.options.dataSource[t]||{}:{},e||{}),Lego.isEmptyObject(o)||i.reset){r.next=7;break}return r.next=4,o;case 4:return r.abrupt("return",r.sent);case 7:if(!n.datas.has(t)||!i.url||!Lego.isEmptyObject(o)&&!i.reset){r.next=16;break}if(a=i.headers||{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},c=Object.assign({},i.body?i.body:{}),"application/x-www-form-urlencoded; charset=UTF-8"==a["Content-type"]&&c&&"object"==typeof c){for(p in c)"object"==typeof c[p]&&(c[p]=JSON.stringify(c[p]));c=Lego.param(c)}return u=new Request(i.url.indexOf("http")?i.url:Lego.config.serviceUri+i.url,{method:i.method||"GET",headers:a,mode:"same-origin",credentials:"include",body:"POST"==i.method?c:void 0}),r.next=14,fetch(u);case 14:return f=r.sent,r.abrupt("return",f.json());case 16:case"end":return r.stop()}},r,this)})())}),p=regeneratorRuntime.values(a);case 4:if((u=p.next()).done){r.next=12;break}return c=u.value,r.next=8,c;case 8:f=r.sent,o.push(f);case 10:r.next=4;break;case 12:r.next=17;break;case 14:r.prev=14,r.t0=r.catch(1),debug.log(r.t0);case 17:return r.abrupt("return",o);case 18:case"end":return r.stop()}},r,this,[[1,14]])}).call(this))},Data.prototype.parse=function(t,e,r){return"function"==typeof this[e]?this[e](t,r):t},Data.prototype.getData=function(t){return t?this.datas.get(t)?this.datas.get(t):{}:this.datas};var Event=function(t){void 0===t&&(t={}),this.listener=new Map};Event.prototype.on=function(t,e){if("function"==typeof e){var r=Symbol(e.name).toString();if(t.indexOf(".")>=0){var n=t.split(".");t=n.shift(),r=n.join(".")}if(this.listener.has(t)){var o=this.listener.get(t);if(o.has(r)){var i=o.get(r);i.push(e)}else o.set(r,[e])}else{var s=new Map;s.set(r,[e]),this.listener.set(t,s)}}},Event.prototype.off=function(t){if(t.indexOf(".")>=0){var e=t.split(".");if(t=e.shift(),eventFunName=e.join("."),this.listener.has(t)){var r=this.listener.get(t);r.has(eventFunName)&&r.delete(eventFunName)}}else this.listener.has(t)&&this.listener.delete(t)},Event.prototype.trigger=function(){for(var t=this,e=[],r=arguments.length;r--;)e[r]=arguments[r];if(e.length){var n=e.shift(),o="";if(n.indexOf(".")>=0){var i=n.split(".");n=i.shift(),o=i.join(".")}if(this.listener.has(n)){var s=this.listener.get(n);if(o){var a=s.get(o);a.forEach(function(r){"function"==typeof r&&r.apply(t,e)})}else s.forEach(function(r,n){r.forEach(function(r){"function"==typeof r&&r.apply(t,e)})})}}},!function(t){function e(t,e,r,o){var i=e&&e.prototype instanceof n?e:n,s=Object.create(i.prototype),a=new h(o||[]);return s._invoke=p(t,r,a),s}function r(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function n(){}function o(){}function i(){}function s(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function a(t){this.arg=t}function c(t){function e(n,o,i,s){var c=r(t[n],t,o);if("throw"!==c.type){var p=c.arg,u=p.value;return u instanceof a?Promise.resolve(u.arg).then(function(t){e("next",t,i,s)},function(t){e("throw",t,i,s)}):Promise.resolve(u).then(function(t){p.value=t,i(p)},s)}s(c.arg)}function n(t,r){function n(){return new Promise(function(n,o){e(t,r,n,o)})}return o=o?o.then(n,n):n()}"object"==typeof process&&process.domain&&(e=process.domain.bind(e));var o;this._invoke=n}function p(t,e,n){var o=E;return function(i,s){if(o===L)throw new Error("Generator is already running");if(o===j){if("throw"===i)throw s;return d()}for(;;){var a=n.delegate;if(a){if("return"===i||"throw"===i&&a.iterator[i]===v){n.delegate=null;var c=a.iterator.return;if(c){var p=r(c,a.iterator,s);if("throw"===p.type){i="throw",s=p.arg;continue}}if("return"===i)continue}var p=r(a.iterator[i],a.iterator,s);if("throw"===p.type){n.delegate=null,i="throw",s=p.arg;continue}i="next",s=v;var u=p.arg;if(!u.done)return o=A,u;n[a.resultName]=u.value,n.next=a.nextLoc,n.delegate=null}if("next"===i)n.sent=n._sent=s;else if("throw"===i){if(o===E)throw o=j,s;n.dispatchException(s)&&(i="next",s=v)}else"return"===i&&n.abrupt("return",s);o=L;var p=r(t,e,n);if("normal"===p.type){o=n.done?j:A;var u={value:p.arg,done:n.done};if(p.arg!==C)return u;n.delegate&&"next"===i&&(s=v)}else"throw"===p.type&&(o=j,i="throw",s=p.arg)}}}function u(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function f(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function h(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(u,this),this.reset(!0)}function l(t){if(t){var e=t[m];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(y.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=v,e.done=!0,e};return n.next=n}}return{next:d}}function d(){return{value:v,done:!0}}var v,y=Object.prototype.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},m=g.iterator||"@@iterator",w=g.toStringTag||"@@toStringTag",b="object"==typeof module,x=t.regeneratorRuntime;if(x)return void(b&&(module.exports=x));x=t.regeneratorRuntime=b?module.exports:{},x.wrap=e;var E="suspendedStart",A="suspendedYield",L="executing",j="completed",C={},N=i.prototype=n.prototype;o.prototype=N.constructor=i,i.constructor=o,i[w]=o.displayName="GeneratorFunction",x.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},x.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,i):(t.__proto__=i,w in t||(t[w]="GeneratorFunction")),t.prototype=Object.create(N),t},x.awrap=function(t){return new a(t)},s(c.prototype),x.async=function(t,r,n,o){var i=new c(e(t,r,n,o));return x.isGeneratorFunction(r)?i:i.next().then(function(t){return t.done?t.value:i.next()})},s(N),N[m]=function(){return this},N[w]="Generator",N.toString=function(){return"[object Generator]"},x.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},x.values=l,h.prototype={constructor:h,reset:function(t){var e=this;if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.tryEntries.forEach(f),!t)for(var r in this)"t"===r.charAt(0)&&y.call(e,r)&&!isNaN(+r.slice(1))&&(e[r]=v)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,r){return s.type="throw",s.arg=t,n.next=e,!!r}var r=this;if(this.done)throw t;for(var n=this,o=this.tryEntries.length-1;o>=0;--o){var i=r.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=r.prev){var a=y.call(i,"catchLoc"),c=y.call(i,"finallyLoc");if(a&&c){if(r.prev<i.catchLoc)return e(i.catchLoc,!0);if(r.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(r.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(r.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var o=r.tryEntries[n];if(o.tryLoc<=r.prev&&y.call(o,"finallyLoc")&&r.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=t,s.arg=e,i?this.next=i.finallyLoc:this.complete(s),C},complete:function(t,e){if("throw"===t.type)throw t.arg;"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=t.arg,this.next="end"):"normal"===t.type&&e&&(this.next=e)},finish:function(t){for(var e=this,r=this.tryEntries.length-1;r>=0;--r){var n=e.tryEntries[r];if(n.finallyLoc===t)return e.complete(n.completion,n.afterLoc),f(n),C}},catch:function(t){for(var e=this,r=this.tryEntries.length-1;r>=0;--r){var n=e.tryEntries[r];if(n.tryLoc===t){var o=n.completion;if("throw"===o.type){var i=o.arg;f(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:l(t),resultName:e,nextLoc:r},C}}}("object"==typeof global?global:"object"==typeof window?window:"object"==typeof self?self:void 0),LegoCore$1.View=View,LegoCore$1.Data=Data,LegoCore$1.Event=Event,LegoCore$1.Ux={},LegoCore$1.Eventer=new Event,module.exports=LegoCore$1;